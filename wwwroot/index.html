<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <title>Discord Music Bot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        * {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            margin: 0;
            background: #121212;
            color: #fff;
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: #181818;
            padding: 16px;
            overflow-y: auto;
            border-right: 1px solid #2a2a2a;
        }

            .sidebar h2 {
                margin-top: 0;
                font-size: 18px;
            }

        .user {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

            .user img {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                margin-right: 10px;
            }

        /* Main */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .topbar {
            padding: 16px;
            border-bottom: 1px solid #2a2a2a;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: none;
            outline: none;
            font-size: 16px;
        }

        .results {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
        }

        .card {
            background: #1f1f1f;
            border-radius: 8px;
            cursor: pointer;
            padding: 10px;
            transition: background .2s;
        }

            .card:hover {
                background: #2a2a2a;
            }

            .card img {
                width: 100%;
                border-radius: 6px;
            }

            .card .title {
                margin-top: 8px;
                font-size: 14px;
                line-height: 1.3;
            }

        /* Player */
        .player {
            height: 80px;
            border-top: 1px solid #2a2a2a;
            display: flex;
            align-items: center;
            padding: 12px;
            background: #181818;
        }

            .player img {
                width: 56px;
                height: 56px;
                border-radius: 6px;
                margin-right: 12px;
            }

        .player-info {
            flex: 1;
        }

        .player-title {
            font-size: 14px;
        }

        .player-controls button {
            margin-left: 10px;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #1db954;
            color: #000;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>🎧 Voice Channel</h2>
        <div id="userList"></div>
    </div>

    <!-- Main -->
    <div class="main">
        <div class="topbar">
            <input id="searchInput"
                   class="search-box"
                   placeholder="ค้นหาเพลง หรือวางลิงก์ YouTube"
                   onkeydown="if(event.key==='Enter') search()" />
        </div>

        <div id="results" class="results"></div>

        <!-- Player -->
        <div class="player">
            <img id="playerThumb" src="" />
            <div class="player-info">
                <div id="playerTitle" class="player-title">ยังไม่ได้เลือกเพลง</div>
            </div>
            <div class="player-controls">
                <button onclick="togglePlay()">⏯</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = ""; // ถ้า backend อยู่ domain เดียวกัน ไม่ต้องใส่

        let currentUserId = "web-user"; // backend ใช้แยก source
        let currentTrack = null;

        async function search() {
            const q = document.getElementById("searchInput").value.trim();
            if (!q) return;

            const res = await fetch(`${API_BASE}/api/search?q=${encodeURIComponent(q)}`);
            const data = await res.json();

            const results = document.getElementById("results");
            results.innerHTML = "";

            data.items.forEach(item => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
            <img src="${item.thumbnail}" />
            <div class="title">${item.title}</div>
          `;
                card.onclick = () => play(item.url, item);
                results.appendChild(card);
            });
        }

        async function play(url, item) {
            currentTrack = item;

            document.getElementById("playerTitle").innerText = item.title;
            document.getElementById("playerThumb").src = item.thumbnail;

            await fetch(`${API_BASE}/play`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    input: url,
                    requestedBy: "Web",
                    source: "web"
                })
            });
        }

        async function togglePlay() {
            await fetch(`${API_BASE}/toggle`, { method: "POST" });
        }

        async function loadStatus() {
            const res = await fetch(`${API_BASE}/status`);
            const data = await res.json();

            const userList = document.getElementById("userList");
            userList.innerHTML = "";

            data.users.forEach(u => {
                const div = document.createElement("div");
                div.className = "user";
                div.innerHTML = `
            <img src="${u.avatar}" />
            <span>${u.name}</span>
          `;
                userList.appendChild(div);
            });
        }

        setInterval(loadStatus, 5000);
        loadStatus();
    </script>

</body>
</html>
