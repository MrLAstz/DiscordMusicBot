<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Discord Music Bot</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f172a;
            color: white;
            text-align: center;
            padding: 40px;
        }

        input {
            width: 300px;
            padding: 10px;
            border-radius: 5px;
            border: none;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background: #3b82f6;
            color: white;
            font-weight: bold;
        }

            button:hover {
                background: #2563eb;
            }

        .player-container {
            margin-top: 20px;
            padding: 20px;
            background: #1e293b;
            display: inline-block;
            border-radius: 12px;
        }
    </style>
</head>
<body>

    <h1>🎵 Discord Music Bot</h1>

    <input id="search" placeholder="พิมพ์ชื่อเพลง หรือวาง Link YouTube">
    <button onclick="search()">ค้นหา</button>
    <button onclick="join()" style="background: #10b981;">Join Voice</button>

    <div id="player"></div>

    <div id="status-bar" style="background: #1e293b; padding: 10px; margin-bottom: 20px; border-radius: 8px; font-size: 0.9em; color: #94a3b8;">
        สถานะบอท: <span id="guild-name" style="color: #10b981; font-weight: bold;">กำลังโหลด...</span>
    </div>
    <script>
        function search() {
            const q = document.getElementById("search").value;
            if (!q) return alert("กรุณาพิมพ์ชื่อเพลง");

            // ปรับการแสดงผล: เนื่องจาก YouTube บล็อก iframe search
            // เราจะโชว์ชื่อเพลงที่จะเล่นแทน เพื่อความชัวร์ในการรันบน Server
            document.getElementById("player").innerHTML = `
                            <div class="player-container">
                                <h3>กำลังเตรียมเล่น: ${q}</h3>
                                <p>กดปุ่มด้านล่างเพื่อส่งเพลงเข้า Discord</p>
                                <button onclick="play('${q}')">▶️ เริ่มเล่นเพลงใน Discord</button>
                            </div>
                        `;
        }

        async function join() {
            try {
                const res = await fetch("/join", { method: "POST" });
                if (res.ok) alert("✅ บอทกำลังเข้าห้องเสียงล่าสุดของคุณ");
                else alert("❌ เกิดข้อผิดพลาด (บอทอาจยังไม่เห็นคุณในห้องเสียง)");
            } catch (e) {
                alert("❌ เชื่อมต่อเซิร์ฟเวอร์ไม่ได้");
            }
        }

        async function play(query) {
            // ส่งแค่ query (ชื่อเพลง) ไปที่ API /play ของเราตรงๆ
            // เดี๋ยว YoutubeService.cs ที่เราแก้ไว้จะไปหาคลิปแรกให้เอง
            try {
                const res = await fetch(`/play?url=${encodeURIComponent(query)}`, { method: "POST" });
                if (res.ok) alert("🎵 สั่งเล่นเพลงสำเร็จ!");
                else alert("❌ สั่งเล่นเพลงไม่สำเร็จ");
            } catch (e) {
                alert("❌ เชื่อมต่อเซิร์ฟเวอร์ไม่ได้");
            }
        }

        async function updateStatus() {
            try {
                const res = await fetch("/status");
                if (!res.ok) throw new Error();
                const data = await res.json();
                document.getElementById("guild-name").innerText = data.guild;
            } catch (e) {
                document.getElementById("guild-name").innerText = "เชื่อมต่อไม่ได้";
            }
        }
    </script>
</body>
</html>