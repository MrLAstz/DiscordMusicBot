[phases.setup]
nixPkgs = ["dotnet-sdk", "libopus", "libsodium", "ffmpeg"]

[phases.build]
cmds = [
    "dotnet publish -c Release -o out",
    # หาไฟล์จริงและก๊อปไปวางใน out โดยตรง
    "cp $(find /nix/store -name 'libopus.so*' | head -n 1) ./out/libopus.so",
    "cp $(find /nix/store -name 'libopus.so*' | head -n 1) ./out/opus.so",
    "cp $(find /nix/store -name 'libsodium.so*' | head -n 1) ./out/libsodium.so",
    "cp $(find /nix/store -name 'libsodium.so*' | head -n 1) ./out/sodium.so",
    # แถม: ให้สิทธิ์การรันไฟล์ (Permission) เผื่อว่ามันโหลดไม่ได้เพราะติดเรื่องสิทธิ์
    "chmod +x ./out/*.so"
]

[start]
cmd = "./out/DiscordMusicBot"