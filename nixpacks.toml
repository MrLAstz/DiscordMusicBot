[phases.setup]
nixPkgs = ["dotnet-sdk", "libopus", "libsodium", "ffmpeg"]

[phases.build]
cmds = [
    "dotnet publish -c Release -o out",
    "find / -name 'libopus.so*' -exec cp {} ./out/libopus.so \\; 2>/dev/null || true",
    "find / -name 'libopus.so*' -exec cp {} ./out/opus.so \\; 2>/dev/null || true",
    "find / -name 'libsodium.so*' -exec cp {} ./out/libsodium.so \\; 2>/dev/null || true",
    "find / -name 'libsodium.so*' -exec cp {} ./out/sodium.so \\; 2>/dev/null || true",
    "chmod +x ./out/*"
]

[start]
cmd = "./out/DiscordMusicBot"